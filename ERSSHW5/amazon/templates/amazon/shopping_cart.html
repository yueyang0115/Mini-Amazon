{% extends "amazon/base.html" %}
{% block content %}
    <h1>Shopping Cart</h1>
    <!-- order list -->
    {% if orders %}
        <!-- NOTE: nested form is not allowed!!! -->
        <form name="form_orders" action="{% url 'shop_cart' %}" method="post">
            {% csrf_token %}
            <div class="table-responsive mt-4 table-hover">
                <table class="table">
                    <thead>
                    <tr class="row text-center">
                        <th class="col-1">#</th>
                        <!-- thumbnail + description -->
                        <th class="col-3 text-left">Item</th>
                        <th class="col-2">Qty</th>
                        <th class="col-2">Price</th>
                        <th class="col-2">Total</th>
                        <!-- delete button -->
                        <th class="col-2"></th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for order in orders %}
                        <tr class="row text-center border-bottom">
                            <td class="col-1 align-self-center border-top-0">
                                <input class="form-check-input" type="checkbox" value="{{ order.id }}" name="checked_orders">
                                <label class="form-check-label" for="check"> {{ forloop.counter }}</label>
                            </td>
                            <td class="col-3 text-left border-top-0">
                                <img class="img-thumbnail" style="width: 50px; height: 50px" src="{{ order.item.img }}">
                                {{ order.item.description }}
                            </td>
                            <td class="col-2 align-self-center border-top-0">{{ order.cnt }}</td>
                            <td class="col-2 align-self-center border-top-0">&dollar; {{ order.item.price }}</td>
                            <td class="col-2 align-self-center border-top-0">&dollar; {{ order.total }}</td>
                            <td class="col-2 align-self-center border-top-0">
                                <button onclick="delete_order({{ order.id }})" class="btn btn-outline-secondary">
                                    Delete
                                </button>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
            <!-- total price -->
            <div class="row">
                <div class="col-5 offset-7 text-right mt-4 mb-4">
                    <b>Total(all items): </b><span style="color: red">&dollar; {{ total }}</span>
                </div>
            </div>
            <div class="text-right">
                <button onclick="check_out()" class="btn btn-primary"><i class="fa fa-dollar"></i> Checkout</button>
            </div>
        </form>
    {% else %}
        <h4 class="m-4">Nothing in you shopping cart,
            <a href="{% url 'home' %}">buy something TODAY!</a>
        </h4>
    {% endif %}
{% endblock content %}
<!-- javascript -->
{% block script %}
    <script type="text/javascript">
        function delete_order(order_id) {
            add_operation_type(document.form_orders, "delete")
            const id_field = document.createElement("input")
            id_field.type = "hidden"
            id_field.name = "order_id"
            id_field.value = order_id
            document.form_orders.appendChild(id_field)
            document.form_orders.submit();
        }

        function check_out() {
            add_operation_type(document.form_orders, "checkout")
            document.form_orders.submit()
        }

        function add_operation_type(element, type) {
            const operation_field = document.createElement("input");
            operation_field.type = "hidden"
            operation_field.name = "operation"
            operation_field.value = type
            element.appendChild(operation_field)
        }
    </script>
{% endblock script %}